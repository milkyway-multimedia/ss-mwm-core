!function(e){e.entwine("ss",function(e){e("div.ss-upload-to-folder").entwine({onfileuploaddone:function(e,t){this.reloadGridField()},onfileuploaddestroy:function(e,t){this.reloadGridField()},reloadGridField:function(){var e=this;setTimeout(function(){var t=e.closest("form").find(".ss-gridfield");t.reload()},10)}}),e("form.uploadfield-form #ParentID .TreeDropdownField").entwine({onchange:function(){var t=this.closest("form").find("input.ss-upload-to-folder:first"),n=this;if(t.length){var a=t.parents(".ss-upload-to-folder:first");config=t.data("config"),config.url&&e.get(config.url.substring(0,config.url.indexOf("/upload"))+"?folder="+this.getValue(),function(e){a.replaceWith(n.addFolderIdToUrlsInHTML(e))})}},addFolderIdToUrlsInHTML:function(e){var t=this.getValue(),n={"\\/upload&quot;":"\\/upload?folder="+t+"&quot;","\\/attach&quot;":"\\/attach?folder="+t+"&quot;","\\/select&quot;":"\\/select?folder="+t+"&quot;","\\/fileexists&quot;":"\\/fileexists?folder="+t+"&quot;"};for(var a in n)n.hasOwnProperty(a)&&(e=e.replace(new RegExp(this.escapeRegExp(a),"g"),n[a]));return e},escapeRegExp:function(e){return e.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")}}),e(".ss-tabset").entwine({onadd:function(){this._super(),window.location.hash&&this.data("tabs")&&e("[aria-controls="+window.location.hash.replace(/^(#tab\-)/,"")+"]").find("a:first").click()}}),e(".ss-tabset-goto").entwine({onclick:function(){window.location.hash&&e("[aria-controls="+window.location.hash.replace(/^(#tab\-)/,"")+"]").find("a:first").click()}})}),e.entwine("ss.tree",function(e){e(".cms .cms-tree").entwine({getTreeConfig:function(){var t=this,n=this._super(),a=e(".cms-container");if(n.hasOwnProperty("contextmenu")){var i=n.contextmenu.items;n.contextmenu.items=function(n){var r=i(n),o=t.data("urlDuplicate");return o&&(r.publish={label:ss.i18n._t("Tree.Publish","Publish"),action:function(n){var i=n.data("id"),r=[i];a.entwine(".ss").loadFragment(e.path.addSearchParams(ss.i18n.sprintf(o.replace("/duplicate","/publish-record"),i),t.data("extraParams")),"SiteTree").success(function(){t.updateNodesFromServer(r)})}},r.unpublish={label:ss.i18n._t("Tree.Unpublish","Unpublish"),action:function(n){var i=n.data("id"),r=[i];a.entwine(".ss").loadFragment(e.path.addSearchParams(ss.i18n.sprintf(o.replace("/duplicate","/unpublish-record"),i),t.data("extraParams")),"SiteTree").success(function(){t.updateNodesFromServer(r)})}},n.hasClass("nodelete")||(r["delete"]={label:ss.i18n._t("Tree.Delete_Permanently","Delete permanently"),action:function(n){if(confirm(ss.i18n._t("CMSMAIN.DELETE_PERMANENTLY","Are you sure you want to delete this page permanently (aka no going back)?"))){var i=n.data("id");a.entwine(".ss").loadFragment(e.path.addSearchParams(ss.i18n.sprintf(o.replace("/duplicate","/annihilate"),i),t.data("extraParams")),"SiteTree").success(function(){var e=t.getNodeByID(i);e.length&&t.jstree("delete_node",e),a.entwine(".ss").reloadCurrentPanel()})}}})),r}}return n}})})}(jQuery);